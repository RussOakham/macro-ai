{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "CDKDeploymentPermissions",
			"Effect": "Allow",
			"Action": [
				"cloudformation:CreateStack",
				"cloudformation:UpdateStack",
				"cloudformation:DeleteStack",
				"cloudformation:DescribeStacks",
				"cloudformation:DescribeStackEvents",
				"cloudformation:DescribeStackResources",
				"cloudformation:GetTemplate",
				"cloudformation:ListStacks",
				"cloudformation:ListStackResources",
				"cloudformation:ValidateTemplate"
			],
			"Resource": [
				"arn:aws:cloudformation:*:*:stack/MacroAi*Stack/*",
				"arn:aws:cloudformation:*:*:stack/CDKToolkit/*"
			]
		},
		{
			"Sid": "LambdaFunctionManagement",
			"Effect": "Allow",
			"Action": [
				"lambda:CreateFunction",
				"lambda:DeleteFunction",
				"lambda:GetFunction",
				"lambda:GetFunctionConfiguration",
				"lambda:UpdateFunctionCode",
				"lambda:UpdateFunctionConfiguration",
				"lambda:ListFunctions",
				"lambda:TagResource",
				"lambda:UntagResource",
				"lambda:AddPermission",
				"lambda:RemovePermission"
			],
			"Resource": ["arn:aws:lambda:*:*:function:macro-ai-*"]
		},
		{
			"Sid": "APIGatewayManagement",
			"Effect": "Allow",
			"Action": ["apigateway:*"],
			"Resource": [
				"arn:aws:apigateway:*::/restapis",
				"arn:aws:apigateway:*::/restapis/*"
			]
		},
		{
			"Sid": "IAMRoleManagement",
			"Effect": "Allow",
			"Action": [
				"iam:CreateRole",
				"iam:DeleteRole",
				"iam:GetRole",
				"iam:PassRole",
				"iam:AttachRolePolicy",
				"iam:DetachRolePolicy",
				"iam:CreatePolicy",
				"iam:DeletePolicy",
				"iam:GetPolicy",
				"iam:GetPolicyVersion",
				"iam:ListPolicyVersions",
				"iam:TagRole",
				"iam:UntagRole",
				"iam:TagPolicy",
				"iam:UntagPolicy"
			],
			"Resource": [
				"arn:aws:iam::*:role/MacroAi*",
				"arn:aws:iam::*:policy/MacroAi*",
				"arn:aws:iam::*:role/cdk-*",
				"arn:aws:iam::*:policy/cdk-*"
			]
		},
		{
			"Sid": "ParameterStoreManagement",
			"Effect": "Allow",
			"Action": [
				"ssm:PutParameter",
				"ssm:GetParameter",
				"ssm:GetParameters",
				"ssm:GetParametersByPath",
				"ssm:DeleteParameter",
				"ssm:DescribeParameters",
				"ssm:AddTagsToResource",
				"ssm:RemoveTagsFromResource"
			],
			"Resource": ["arn:aws:ssm:*:*:parameter/macro-ai/*"]
		},
		{
			"Sid": "CloudWatchLogsManagement",
			"Effect": "Allow",
			"Action": [
				"logs:CreateLogGroup",
				"logs:DeleteLogGroup",
				"logs:DescribeLogGroups",
				"logs:PutRetentionPolicy",
				"logs:TagLogGroup",
				"logs:UntagLogGroup"
			],
			"Resource": [
				"arn:aws:logs:*:*:log-group:/aws/lambda/macro-ai-*",
				"arn:aws:logs:*:*:log-group:/aws/amplify/*"
			]
		},
		{
			"Sid": "S3BucketManagement",
			"Effect": "Allow",
			"Action": [
				"s3:CreateBucket",
				"s3:DeleteBucket",
				"s3:GetBucketLocation",
				"s3:GetBucketPolicy",
				"s3:PutBucketPolicy",
				"s3:DeleteBucketPolicy",
				"s3:GetBucketVersioning",
				"s3:PutBucketVersioning",
				"s3:GetBucketPublicAccessBlock",
				"s3:PutBucketPublicAccessBlock",
				"s3:GetObject",
				"s3:PutObject",
				"s3:DeleteObject",
				"s3:ListBucket"
			],
			"Resource": [
				"arn:aws:s3:::cdk-*",
				"arn:aws:s3:::cdk-*/*",
				"arn:aws:s3:::amplify-*",
				"arn:aws:s3:::amplify-*/*"
			]
		},
		{
			"Sid": "AmplifyFullManagement",
			"Effect": "Allow",
			"Action": [
				"amplify:CreateApp",
				"amplify:DeleteApp",
				"amplify:GetApp",
				"amplify:ListApps",
				"amplify:UpdateApp",
				"amplify:CreateBranch",
				"amplify:DeleteBranch",
				"amplify:GetBranch",
				"amplify:ListBranches",
				"amplify:UpdateBranch",
				"amplify:StartDeployment",
				"amplify:StartJob",
				"amplify:StopJob",
				"amplify:GetJob",
				"amplify:ListJobs",
				"amplify:CreateDomainAssociation",
				"amplify:DeleteDomainAssociation",
				"amplify:GetDomainAssociation",
				"amplify:ListDomainAssociations",
				"amplify:UpdateDomainAssociation",
				"amplify:TagResource",
				"amplify:UntagResource",
				"amplify:ListTagsForResource"
			],
			"Resource": "*",
			"Condition": {
				"StringLike": {
					"amplify:appName": [
						"macro-ai-frontend-pr-*",
						"macro-ai-frontend-staging",
						"macro-ai-frontend-production",
						"macro-ai-frontend-development"
					]
				}
			}
		},
		{
			"Sid": "CloudFormationStackDiscovery",
			"Effect": "Allow",
			"Action": [
				"cloudformation:DescribeStacks",
				"cloudformation:DescribeStackResources",
				"cloudformation:DescribeStackEvents",
				"cloudformation:GetTemplate",
				"cloudformation:ListStacks",
				"cloudformation:ListStackResources"
			],
			"Resource": "*"
		},
		{
			"Sid": "STSAndIdentityAccess",
			"Effect": "Allow",
			"Action": ["sts:GetCallerIdentity", "sts:AssumeRole"],
			"Resource": "*"
		},
		{
			"Sid": "EC2HealthCheckPermissions",
			"Effect": "Allow",
			"Action": [
				"ec2:DescribeInstances",
				"ec2:DescribeInstanceStatus",
				"autoscaling:DescribeAutoScalingGroups",
				"elasticloadbalancing:DescribeTargetHealth",
				"elasticloadbalancing:DescribeTargetGroups"
			],
			"Resource": "*"
		},
		{
			"Sid": "KMSKeyAccess",
			"Effect": "Allow",
			"Action": ["kms:Decrypt", "kms:DescribeKey", "kms:GenerateDataKey"],
			"Resource": "*",
			"Condition": {
				"StringLike": {
					"kms:ViaService": ["ssm.*.amazonaws.com", "s3.*.amazonaws.com"]
				}
			}
		},
		{
			"Sid": "ServiceLinkedRoleCreation",
			"Effect": "Allow",
			"Action": ["iam:CreateServiceLinkedRole"],
			"Resource": [
				"arn:aws:iam::*:role/aws-service-role/amplify.amazonaws.com/AWSServiceRoleForAmplifyBackend",
				"arn:aws:iam::*:role/aws-service-role/lambda.amazonaws.com/AWSServiceRoleForLambdaReplication"
			],
			"Condition": {
				"StringEquals": {
					"iam:AWSServiceName": [
						"amplify.amazonaws.com",
						"lambda.amazonaws.com"
					]
				}
			}
		}
	]
}
