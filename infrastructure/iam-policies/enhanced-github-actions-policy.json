{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "CDKDeploymentPermissions",
			"Effect": "Allow",
			"Action": [
				"cloudformation:CreateStack",
				"cloudformation:UpdateStack",
				"cloudformation:DeleteStack",
				"cloudformation:DescribeStacks",
				"cloudformation:DescribeStackEvents",
				"cloudformation:DescribeStackResources",
				"cloudformation:GetTemplate",
				"cloudformation:ListStacks",
				"cloudformation:ListStackResources",
				"cloudformation:ValidateTemplate"
			],
			"Resource": [
				"arn:aws:cloudformation:*:*:stack/MacroAi*Stack/*",
				"arn:aws:cloudformation:*:*:stack/CDKToolkit/*"
			]
		},
		{
			"Sid": "LambdaFunctionManagement",
			"Effect": "Allow",
			"Action": [
				"lambda:CreateFunction",
				"lambda:DeleteFunction",
				"lambda:GetFunction",
				"lambda:GetFunctionConfiguration",
				"lambda:UpdateFunctionCode",
				"lambda:UpdateFunctionConfiguration",
				"lambda:ListFunctions",
				"lambda:TagResource",
				"lambda:UntagResource",
				"lambda:AddPermission",
				"lambda:RemovePermission"
			],
			"Resource": ["arn:aws:lambda:*:*:function:macro-ai-*"]
		},
		{
			"Sid": "APIGatewayManagement",
			"Effect": "Allow",
			"Action": ["apigateway:*"],
			"Resource": [
				"arn:aws:apigateway:*::/restapis",
				"arn:aws:apigateway:*::/restapis/*"
			]
		},
		{
			"Sid": "IAMRoleManagement",
			"Effect": "Allow",
			"Action": [
				"iam:CreateRole",
				"iam:DeleteRole",
				"iam:GetRole",
				"iam:PassRole",
				"iam:AttachRolePolicy",
				"iam:DetachRolePolicy",
				"iam:CreatePolicy",
				"iam:DeletePolicy",
				"iam:GetPolicy",
				"iam:GetPolicyVersion",
				"iam:ListPolicyVersions",
				"iam:TagRole",
				"iam:UntagRole",
				"iam:TagPolicy",
				"iam:UntagPolicy"
			],
			"Resource": [
				"arn:aws:iam::*:role/MacroAi*",
				"arn:aws:iam::*:policy/MacroAi*",
				"arn:aws:iam::*:role/cdk-*",
				"arn:aws:iam::*:policy/cdk-*"
			]
		},
		{
			"Sid": "ParameterStoreManagement",
			"Effect": "Allow",
			"Action": [
				"ssm:PutParameter",
				"ssm:GetParameter",
				"ssm:GetParameters",
				"ssm:GetParametersByPath",
				"ssm:DeleteParameter",
				"ssm:DescribeParameters",
				"ssm:AddTagsToResource",
				"ssm:RemoveTagsFromResource"
			],
			"Resource": [
				"arn:aws:ssm:*:*:parameter/macro-ai/*",
				"arn:aws:ssm:*:*:parameter/macro-ai-*"
			]
		},
		{
			"Sid": "CloudWatchLogsManagement",
			"Effect": "Allow",
			"Action": [
				"logs:CreateLogGroup",
				"logs:DeleteLogGroup",
				"logs:DescribeLogGroups",
				"logs:PutRetentionPolicy",
				"logs:TagLogGroup",
				"logs:UntagLogGroup"
			],
			"Resource": [
				"arn:aws:logs:*:*:log-group:/aws/lambda/macro-ai-*",
				"arn:aws:logs:*:*:log-group:/aws/amplify/*"
			]
		},
		{
			"Sid": "S3BucketManagement",
			"Effect": "Allow",
			"Action": [
				"s3:CreateBucket",
				"s3:DeleteBucket",
				"s3:GetBucketLocation",
				"s3:GetBucketPolicy",
				"s3:PutBucketPolicy",
				"s3:DeleteBucketPolicy",
				"s3:GetBucketVersioning",
				"s3:PutBucketVersioning",
				"s3:GetBucketPublicAccessBlock",
				"s3:PutBucketPublicAccessBlock",
				"s3:GetObject",
				"s3:PutObject",
				"s3:DeleteObject",
				"s3:ListBucket"
			],
			"Resource": [
				"arn:aws:s3:::cdk-*",
				"arn:aws:s3:::cdk-*/*",
				"arn:aws:s3:::amplify-*",
				"arn:aws:s3:::amplify-*/*",
				"arn:aws:s3:::macro-ai-deployment-artifacts-*",
				"arn:aws:s3:::macro-ai-deployment-artifacts-*/*"
			]
		},
		{
			"Sid": "AmplifyFullManagement",
			"Effect": "Allow",
			"Action": [
				"amplify:CreateApp",
				"amplify:DeleteApp",
				"amplify:GetApp",
				"amplify:ListApps",
				"amplify:UpdateApp",
				"amplify:CreateBranch",
				"amplify:DeleteBranch",
				"amplify:GetBranch",
				"amplify:ListBranches",
				"amplify:UpdateBranch",
				"amplify:StartDeployment",
				"amplify:StartJob",
				"amplify:StopJob",
				"amplify:GetJob",
				"amplify:ListJobs",
				"amplify:CreateDomainAssociation",
				"amplify:DeleteDomainAssociation",
				"amplify:GetDomainAssociation",
				"amplify:ListDomainAssociations",
				"amplify:UpdateDomainAssociation",
				"amplify:TagResource",
				"amplify:UntagResource",
				"amplify:ListTagsForResource"
			],
			"Resource": "*",
			"Condition": {
				"StringLike": {
					"amplify:appName": [
						"macro-ai-frontend-pr-*",
						"macro-ai-frontend-staging",
						"macro-ai-frontend-production",
						"macro-ai-frontend-development"
					]
				}
			}
		},
		{
			"Sid": "CloudFormationStackDiscovery",
			"Effect": "Allow",
			"Action": [
				"cloudformation:DescribeStacks",
				"cloudformation:DescribeStackResources",
				"cloudformation:DescribeStackEvents",
				"cloudformation:GetTemplate",
				"cloudformation:ListStacks",
				"cloudformation:ListStackResources"
			],
			"Resource": "*"
		},
		{
			"Sid": "STSAndIdentityAccess",
			"Effect": "Allow",
			"Action": ["sts:GetCallerIdentity", "sts:AssumeRole"],
			"Resource": "*"
		},
		{
			"Sid": "ServiceHealthCheckPermissions",
			"Effect": "Allow",
			"Action": [
				"ecs:DescribeClusters",
				"ecs:DescribeServices",
				"ecs:ListTasks",
				"ecs:DescribeTasks",
				"elasticloadbalancing:DescribeTargetHealth",
				"elasticloadbalancing:DescribeTargetGroups",
				"ec2:DescribeInstances",
				"ec2:DescribeInstanceStatus",
				"autoscaling:DescribeAutoScalingGroups"
			],
			"Resource": "*"
		},
		{
			"Sid": "EC2DeploymentPermissions",
			"Effect": "Allow",
			"Action": [
				"ec2:CreateInstance",
				"ec2:RunInstances",
				"ec2:TerminateInstances",
				"ec2:StartInstances",
				"ec2:StopInstances",
				"ec2:RebootInstances",
				"ec2:ModifyInstanceAttribute",
				"ec2:ModifyInstanceCreditSpecification",
				"ec2:DescribeInstances",
				"ec2:DescribeInstanceStatus",
				"ec2:DescribeInstanceAttribute",
				"ec2:DescribeInstanceCreditSpecifications",
				"ec2:DescribeInstanceTypes",
				"ec2:DescribeVpcs",
				"ec2:DescribeSubnets",
				"ec2:DescribeSecurityGroups",
				"ec2:DescribeKeyPairs",
				"ec2:DescribeImages",
				"ec2:DescribeAvailabilityZones",
				"ec2:DescribeRegions",
				"ec2:CreateTags",
				"ec2:DeleteTags",
				"ec2:DescribeTags"
			],
			"Resource": "*"
		},
		{
			"Sid": "KMSKeyAccess",
			"Effect": "Allow",
			"Action": ["kms:Decrypt", "kms:DescribeKey", "kms:GenerateDataKey"],
			"Resource": "*",
			"Condition": {
				"StringLike": {
					"kms:ViaService": ["ssm.*.amazonaws.com", "s3.*.amazonaws.com"]
				}
			}
		},
		{
			"Sid": "ServiceLinkedRoleCreation",
			"Effect": "Allow",
			"Action": ["iam:CreateServiceLinkedRole"],
			"Resource": [
				"arn:aws:iam::*:role/aws-service-role/amplify.amazonaws.com/AWSServiceRoleForAmplifyBackend",
				"arn:aws:iam::*:role/aws-service-role/lambda.amazonaws.com/AWSServiceRoleForLambdaReplication"
			],
			"Condition": {
				"StringEquals": {
					"iam:AWSServiceName": [
						"amplify.amazonaws.com",
						"lambda.amazonaws.com"
					]
				}
			}
		},
		{
			"Sid": "Route53ListHostedZones",
			"Effect": "Allow",
			"Action": ["route53:ListHostedZones"],
			"Resource": "*"
		},
		{
			"Sid": "Route53CustomDomainPermissions",
			"Effect": "Allow",
			"Action": [
				"route53:GetHostedZone",
				"route53:GetChange",
				"route53:ListResourceRecordSets",
				"route53:ChangeResourceRecordSets"
			],
			"Resource": "*",
			"Condition": {
				"StringLike": {
					"route53:HostedZoneId": ["Z10081873B648ARROPNER"]
				}
			}
		},
		{
			"Sid": "ACMCertificatePermissions",
			"Effect": "Allow",
			"Action": [
				"acm:ListCertificates",
				"acm:DescribeCertificate",
				"acm:RequestCertificate",
				"acm:AddTagsToCertificate"
			],
			"Resource": "*",
			"Condition": {
				"StringEquals": {
					"aws:RequestedRegion": ["us-east-1", "us-west-2"]
				}
			}
		},
		{
			"Sid": "ECRAccess",
			"Effect": "Allow",
			"Action": [
				"ecr:GetAuthorizationToken",
				"ecr:BatchCheckLayerAvailability",
				"ecr:GetDownloadUrlForLayer",
				"ecr:BatchGetImage",
				"ecr:InitiateLayerUpload",
				"ecr:UploadLayerPart",
				"ecr:CompleteLayerUpload",
				"ecr:PutImage",
				"ecr:CreateRepository",
				"ecr:DescribeRepositories",
				"ecr:ListImages",
				"ecr:TagResource",
				"ecr:UntagResource"
			],
			"Resource": "*"
		},
		{
			"Sid": "ECSDeploymentPermissions",
			"Effect": "Allow",
			"Action": [
				"ecs:RegisterTaskDefinition",
				"ecs:DeregisterTaskDefinition",
				"ecs:DescribeTaskDefinition",
				"ecs:UpdateService",
				"ecs:DescribeServices",
				"ecs:DescribeClusters",
				"ecs:CreateService",
				"ecs:DeleteService",
				"ecs:ListServices",
				"ecs:ListTaskDefinitions",
				"ecs:ListTasks",
				"ecs:DescribeTasks",
				"application-autoscaling:RegisterScalableTarget",
				"application-autoscaling:PutScalingPolicy",
				"application-autoscaling:DescribeScalableTargets",
				"application-autoscaling:DescribeScalingPolicies"
			],
			"Resource": "*"
		}
	]
}
