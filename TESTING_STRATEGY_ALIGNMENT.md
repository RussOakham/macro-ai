# Testing Strategy Alignment with CLAUDE.md Guidelines

## Overview

This document outlines how our current testing and coverage configuration aligns with the testing requirements specified
in `CLAUDE.md`.

## Current Coverage Exclusions Analysis

### ✅ **Correctly Excluded (Aligned with Guidelines)**

1. **Autogenerated Files** - `**/*.gen.ts`, `**/routeTree.gen.ts`
   - **Rationale**: These are auto-generated API clients and route trees
   - **Guideline Alignment**: "Do not generate redundant tests for trivial code" and "Over-specify tests for third-party
     libraries — assume they are tested upstream"
   - **Examples**:
     - `packages/macro-ai-api-client/src/client/client.gen.ts`
     - `apps/client-ui/src/routeTree.gen.ts`

2. **Test Files** - `**/*.test.ts`, `**/*.spec.ts`
   - **Rationale**: Standard practice - don't test the tests
   - **Guideline Alignment**: Standard testing practice

3. **Build Artifacts** - `node_modules/`, `dist/`, `coverage/**`
   - **Rationale**: These are not source code
   - **Guideline Alignment**: Standard practice

4. **Type Definitions** - `**/*.d.ts`
   - **Rationale**: Type-only files with no runtime logic
   - **Guideline Alignment**: "Do not generate redundant tests for trivial code"

5. **Configuration Files** - `**/*.config.*`
   - **Rationale**: Configuration files typically don't contain business logic
   - **Guideline Alignment**: Focus on "Core logic correctness"

6. **Main Entry Points** - `**/main.tsx`, `**/main.ts`
   - **Rationale**: Entry points typically only contain initialization code
   - **Guideline Alignment**: Focus on "Core logic correctness"

### ⚠️ **React Components Strategy (Updated)**

**Previous Approach**: Exclude React components entirely
**Updated Approach**: Include React components but focus testing on business logic

**Guideline Alignment**:

> **Frontend (`apps/frontend`)**
>
> - **.tsx files:** Only unit test hooks.
> - **.ts files:** Unit test all functionality.

**Implementation**:

- **Include** `.tsx` files in coverage
- **Test** components that contain:
  - Custom hooks
  - State management logic
  - Business logic
  - Event handlers with logic
- **Don't test** pure presentational components (just JSX)

## Testing Priorities (Per CLAUDE.md)

### 1. **Core Logic Correctness**

- Business logic in services
- Data transformation functions
- Validation logic
- State management

### 2. **Critical Failure Paths**

- Error handling
- Edge cases in business logic
- Network failure scenarios
- Authentication/authorization

### 3. **Integration with External Systems** (mocked)

- API calls
- Database operations
- Third-party service integrations

## Coverage Thresholds

### Backend (`apps/express-api`)

- **Statements**: 80%
- **Branches**: 75%
- **Functions**: 80%
- **Lines**: 80%

**Rationale**: Backend should have high coverage as per guidelines: "Unit test **everything** (business logic, API routes,
services)."

### Frontend (`apps/client-ui`)

- **Statements**: 60%
- **Branches**: 50%
- **Functions**: 60%
- **Lines**: 60%

**Rationale**: Lower thresholds initially for React components, focusing on hooks and business logic rather than pure presentation.

### Infrastructure (`packages/config`, etc.)

- **Statements**: 80%
- **Branches**: 75%
- **Functions**: 80%
- **Lines**: 80%

**Rationale**: Per guidelines: "Unit test **everything** (schemas, utils, IaC helpers)."

## What NOT to Test (Per Guidelines)

1. **Trivial Code**
   - Type-only exports
   - Simple constants
   - Pure configuration objects

2. **Third-party Libraries**
   - Assume they are tested upstream
   - Only test integration points

3. **Contrived Edge Cases**
   - Unless explicitly relevant to business logic
   - Focus on realistic scenarios

## Recommendations

### ✅ **Current Configuration is Well-Aligned**

Your coverage exclusions are sensible and follow testing best practices. The main areas that were already correctly configured:

1. **Autogenerated files exclusion** - Perfect alignment with guidelines
2. **Standard exclusions** - All appropriate
3. **Threshold strategy** - Realistic and achievable

### 🔧 **Minor Improvements Made**

1. **Added main entry point exclusions** to common config
2. **Clarified React component testing strategy** in comments
3. **Enhanced documentation** of exclusion rationale

### 📋 **Next Steps**

1. **Focus on testing business logic** in React components rather than presentation
2. **Prioritize hooks and state management** in frontend testing
3. **Maintain high coverage** for backend and infrastructure code
4. **Use the coverage gap analysis tool** to identify specific areas needing attention

## Conclusion

Your coverage reporting omissions are **sensible and well-aligned** with your `CLAUDE.md` testing guidelines. The
configuration appropriately excludes autogenerated files, build artifacts, and trivial code while maintaining focus on
testing core business logic, critical failure paths, and integration points.
